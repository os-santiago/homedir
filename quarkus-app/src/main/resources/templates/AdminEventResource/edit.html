{#include layout/main}
{#title}
{#if event.id}
Editar Evento 路 Homedir
{#else}
Nuevo Evento 路 Homedir
{/if}
{/title}
{#body}
<section class="hd-section hd-section-dashboard">
  <div class="hd-page">
    <div class="hd-dashboard-header">
      <div>
        <p class="hd-eyebrow">Evento</p>
        <h1 class="hd-page-title">
        {#if event.id}
          Editar Evento
        {#else}
          Nuevo Evento
        {/if}
        </h1>
        {#if message}<p class="hd-page-intro">{message}</p>{/if}
      </div>
      <div class="hd-panel-actions">
        <a href="/private/admin/events" class="hd-btn hd-btn-secondary">Volver a la administraci贸n de Eventos</a>
      </div>
    </div>

    <nav class="hd-subnav">
      <a href="#event-info">Evento</a>
      {#if event.id}
      <a href="#scenarios">Escenarios</a>
      <a href="#talks">Charlas</a>
      <a href="#breaks">Breaks</a>
      <a href="#agenda">Agenda</a>
      {/if}
    </nav>

    <div id="event-info" class="hd-panel">
      <h2 class="hd-panel-title">Datos del evento</h2>
      <form method="post" action="{#if event.id}/private/admin/events/{event.id}/edit{#else}/private/admin/events/new{/if}" class="hd-form">
        {#if event.id}
          <p class="hd-form-hint">ID: {event.id}</p>
        {/if}
        <div class="hd-form-grid">
          <div class="hd-form-field">
            <label for="title" class="hd-form-label">T铆tulo</label>
            <input id="title" name="title" type="text" value="{event.title}" class="hd-form-input">
          </div>
          <div class="hd-form-field">
            <label for="type" class="hd-form-label">Tipo de evento</label>
            <select id="type" name="type" class="hd-form-input">
              {#for t in types}
              <option value="{t.name()}"{#if event.type?? && event.type.name() == t.name()} selected{/if}>{t.label}</option>
              {/for}
            </select>
          </div>
          <div class="hd-form-field">
            <label for="date" class="hd-form-label">Fecha de realizaci贸n</label>
            <input id="date" name="date" type="date" value="{event.dateStr}" class="hd-form-input">
          </div>
          <div class="hd-form-field">
            <label for="timezone" class="hd-form-label">Zona horaria</label>
            <select id="timezone" name="timezone" class="hd-form-input">
              {#for tz in app:commonTimezones()}
              <option value="{tz}"{#if tz == event.timezone} selected{/if}>{tz} ({app:zoneDetail(tz)})</option>
              {/for}
            </select>
          </div>
          <div class="hd-form-field">
            <label for="days" class="hd-form-label">D铆as del evento</label>
            <input id="days" name="days" type="number" min="1" max="10" value="{event.days}" class="hd-form-input">
          </div>
          <div class="hd-form-field">
            <label for="logoUrl" class="hd-form-label">Logo URL</label>
            <input id="logoUrl" name="logoUrl" type="url" value="{event.logoUrl}" class="hd-form-input">
          </div>
          <div class="hd-form-field">
            <label for="mapUrl" class="hd-form-label">Mapa URL</label>
            <input id="mapUrl" name="mapUrl" type="url" value="{event.mapUrl}" class="hd-form-input">
          </div>
          <div class="hd-form-field">
            <label for="website" class="hd-form-label">Sitio Web</label>
            <input id="website" name="website" type="url" value="{event.website}" class="hd-form-input">
          </div>
          <div class="hd-form-field">
            <label for="contactEmail" class="hd-form-label">Correo de contacto</label>
            <input id="contactEmail" name="contactEmail" type="email" value="{event.contactEmail}" class="hd-form-input">
          </div>
          <div class="hd-form-field">
            <label for="ticketsUrl" class="hd-form-label">Link de entradas</label>
            <input id="ticketsUrl" name="ticketsUrl" type="url" value="{event.ticketsUrl}" class="hd-form-input">
          </div>
        </div>
        <div class="hd-form-field">
          <label for="description" class="hd-form-label">Descripci贸n</label>
          <textarea id="description" name="description" class="hd-form-input">{event.description}</textarea>
        </div>
        <p class="hd-form-hint">Horario calculado: {#if event.startTimeStr}{event.startTimeStr} - {event.endTimeStr}{#else}Sin charlas{/if}</p>
        <fieldset class="hd-form-field">
          <legend class="hd-form-label">Redes Sociales</legend>
          <div class="hd-form-grid">
            <div class="hd-form-field">
              <label for="twitter" class="hd-form-label">Twitter/X</label>
              <input id="twitter" name="twitter" type="url" value="{event.twitter}" class="hd-form-input">
            </div>
            <div class="hd-form-field">
              <label for="linkedin" class="hd-form-label">LinkedIn</label>
              <input id="linkedin" name="linkedin" type="url" value="{event.linkedin}" class="hd-form-input">
            </div>
            <div class="hd-form-field">
              <label for="instagram" class="hd-form-label">Instagram</label>
              <input id="instagram" name="instagram" type="url" value="{event.instagram}" class="hd-form-input">
            </div>
          </div>
        </fieldset>
        <div class="hd-form-actions">
          <button type="submit" class="hd-btn hd-btn-primary">Guardar</button>
        </div>
      </form>
    </div>

    {#if event.id}
    <div id="scenarios" class="hd-panel">
      <h2 class="hd-panel-title">Escenarios</h2>
      {#for sc in event.scenarios}
      <div class="hd-card-surface" style="margin-bottom: 1rem;">
        <form method="post" action="/private/admin/events/{event.id}/scenario" class="hd-form">
          <input type="hidden" name="scenarioId" value="{sc.id}">
          <div class="hd-form-grid">
            <div class="hd-form-field"><label class="hd-form-label">ID</label><input class="hd-form-input" value="{sc.id}" disabled></div>
            <div class="hd-form-field"><label class="hd-form-label">Nombre</label><input name="name" value="{sc.name}" class="hd-form-input"></div>
            <div class="hd-form-field"><label class="hd-form-label">Caracter铆sticas</label><input name="features" value="{sc.features}" placeholder="Caracter铆sticas" class="hd-form-input"></div>
            <div class="hd-form-field"><label class="hd-form-label">Ubicaci贸n</label><input name="location" value="{sc.location}" placeholder="Ubicaci贸n" class="hd-form-input"></div>
          </div>
          <div class="hd-form-actions">
            <button type="submit" class="hd-btn hd-btn-secondary">Guardar</button>
          </div>
        </form>
        <form method="post" action="/private/admin/events/{event.id}/scenario/{sc.id}/delete" class="needs-confirm hd-form-actions">
          <button type="submit" class="hd-btn">Eliminar</button>
        </form>
      </div>
      {/for}
      <div class="hd-card-surface">
        <form method="post" action="/private/admin/events/{event.id}/scenario" class="hd-form">
          <div class="hd-form-grid">
            <div class="hd-form-field"><label class="hd-form-label">Nombre</label><input name="name" class="hd-form-input"></div>
            <div class="hd-form-field"><label class="hd-form-label">Caracter铆sticas</label><input name="features" placeholder="Caracter铆sticas" class="hd-form-input"></div>
            <div class="hd-form-field"><label class="hd-form-label">Ubicaci贸n</label><input name="location" placeholder="Ubicaci贸n" class="hd-form-input"></div>
          </div>
          <div class="hd-form-actions">
            <button type="submit" class="hd-btn hd-btn-primary">Agregar escenario</button>
          </div>
        </form>
      </div>
    </div>

    <div id="talks" class="hd-panel">
      <h2 class="hd-panel-title">Charlas</h2>
      {#for t in event.agenda}
      {#if !t.break}
      <div class="hd-card-surface" style="margin-bottom: 1rem;">
        <form method="post" action="/private/admin/events/{event.id}/talk" class="hd-form">
          <input type="hidden" name="talkId" value="{t.id}">
          <div class="hd-form-grid">
            <div class="hd-form-field"><label class="hd-form-label">ID</label><input class="hd-form-input" value="{t.id}" disabled></div>
            <div class="hd-form-field"><label class="hd-form-label">Charla</label><p class="hd-form-hint">{t.name}{#if !t.speakers.isEmpty()} 路 {t.getSpeakerNames()}{/if}</p></div>
            <div class="hd-form-field">
              <label class="hd-form-label">Ubicaci贸n</label>
              <select name="location" class="hd-form-input">
              {#for sc in event.scenarios}
              <option value="{sc.id}"{#if sc.id == t.location} selected{/if}>{sc.name}</option>
              {/for}
              </select>
            </div>
            <div class="hd-form-field"><label class="hd-form-label">Hora inicio</label><input name="startTime" type="time" value="{t.startTimeStr}" class="hd-form-input"></div>
            <div class="hd-form-field">
              <label class="hd-form-label">D铆a</label>
              <select name="day" class="hd-form-input">
              {#for d in event.dayList}
              <option value="{d}"{#if t.day == d} selected{/if}>D铆a {d}</option>
              {/for}
              </select>
            </div>
          </div>
          <div class="hd-form-actions">
            <button type="submit" class="hd-btn hd-btn-secondary">Guardar</button>
          </div>
        </form>
        <form method="post" action="/private/admin/events/{event.id}/talk/{t.id}/delete" style="display:inline" class="needs-confirm hd-form-actions">
          <button type="submit" class="hd-btn">Eliminar</button>
        </form>
      </div>
      {/if}
      {/for}
      <div class="hd-card-surface">
        <form method="post" action="/private/admin/events/{event.id}/talk" class="hd-form">
          <div class="hd-form-grid">
            <div class="hd-form-field">
              <label class="hd-form-label" for="speakerSelect">Seleccione orador</label>
              <select id="speakerSelect" name="speakerId" class="hd-form-input">
                <option value="">Seleccione orador</option>
                {#for sp in speakers}
                <option value="{sp.id}">{sp.name}</option>
                {/for}
              </select>
            </div>
            <div class="hd-form-field">
              <label class="hd-form-label" for="talkSelect">Seleccione charla</label>
              <select id="talkSelect" name="talkId" class="hd-form-input">
                <option value="">Seleccione charla</option>
                {#for sp in speakers}
                  {#for t in sp.talks}
                  <option value="{t.id}" data-speaker="{sp.id}">{t.name}</option>
                  {/for}
                {/for}
              </select>
            </div>
            <div class="hd-form-field">
              <label class="hd-form-label">Ubicaci贸n</label>
              <select name="location" class="hd-form-input">
              {#for sc in event.scenarios}
              <option value="{sc.id}">{sc.name}</option>
              {/for}
              </select>
            </div>
            <div class="hd-form-field"><label class="hd-form-label">Hora inicio</label><input name="startTime" type="time" class="hd-form-input"></div>
            <div class="hd-form-field">
              <label class="hd-form-label">D铆a</label>
              <select name="day" class="hd-form-input">
              {#for d in event.dayList}
              <option value="{d}">D铆a {d}</option>
              {/for}
              </select>
            </div>
          </div>
          <div class="hd-form-actions">
            <button type="submit" class="hd-btn hd-btn-primary">Agregar charla</button>
          </div>
        </form>
      </div>
    </div>

    <div id="breaks" class="hd-panel">
      <h2 class="hd-panel-title">Breaks</h2>
      {#for t in event.agenda}
      {#if t.break}
      <div class="hd-card-surface" style="margin-bottom: 1rem;">
        <form method="post" action="/private/admin/events/{event.id}/break" class="hd-form">
          <input type="hidden" name="breakId" value="{t.id}">
          <div class="hd-form-grid">
            <div class="hd-form-field"><label class="hd-form-label">ID</label><input class="hd-form-input" value="{t.id}" disabled></div>
            <div class="hd-form-field"><label class="hd-form-label">Break</label><input name="name" value="{t.name}" class="hd-form-input"></div>
            <div class="hd-form-field"><label class="hd-form-label">Duraci贸n</label><input name="duration" type="number" min="1" value="{t.durationMinutes}" class="hd-form-input"></div>
            <div class="hd-form-field">
              <label class="hd-form-label">Ubicaci贸n</label>
              <select name="location" class="hd-form-input">
              {#for sc in event.scenarios}
              <option value="{sc.id}"{#if sc.id == t.location} selected{/if}>{sc.name}</option>
              {/for}
              </select>
            </div>
            <div class="hd-form-field"><label class="hd-form-label">Hora inicio</label><input name="startTime" type="time" value="{t.startTimeStr}" class="hd-form-input"></div>
            <div class="hd-form-field">
              <label class="hd-form-label">D铆a</label>
              <select name="day" class="hd-form-input">
              {#for d in event.dayList}
              <option value="{d}"{#if t.day == d} selected{/if}>D铆a {d}</option>
              {/for}
              </select>
            </div>
          </div>
          <div class="hd-form-actions">
            <button type="submit" class="hd-btn hd-btn-secondary">Guardar</button>
          </div>
        </form>
        <form method="post" action="/private/admin/events/{event.id}/break/{t.id}/delete" style="display:inline" class="needs-confirm hd-form-actions">
          <button type="submit" class="hd-btn">Eliminar</button>
        </form>
      </div>
      {/if}
      {/for}
      <div class="hd-card-surface">
        <form method="post" action="/private/admin/events/{event.id}/break" class="hd-form">
          <div class="hd-form-grid">
            <div class="hd-form-field"><label class="hd-form-label">Break</label><input name="name" class="hd-form-input"></div>
            <div class="hd-form-field"><label class="hd-form-label">Duraci贸n</label><input name="duration" type="number" min="1" class="hd-form-input"></div>
            <div class="hd-form-field">
              <label class="hd-form-label">Ubicaci贸n</label>
              <select name="location" class="hd-form-input">
              {#for sc in event.scenarios}
              <option value="{sc.id}">{sc.name}</option>
              {/for}
              </select>
            </div>
            <div class="hd-form-field"><label class="hd-form-label">Hora inicio</label><input name="startTime" type="time" class="hd-form-input"></div>
            <div class="hd-form-field">
              <label class="hd-form-label">D铆a</label>
              <select name="day" class="hd-form-input">
              {#for d in event.dayList}
              <option value="{d}">D铆a {d}</option>
              {/for}
              </select>
            </div>
          </div>
          <div class="hd-form-actions">
            <button type="submit" class="hd-btn hd-btn-primary">Agregar break</button>
          </div>
        </form>
      </div>
    </div>

    <div id="agenda" class="hd-panel">
      <h2 class="hd-panel-title">Agenda</h2>
      {#for d in event.dayList}
      <div class="hd-card-surface" style="margin-bottom: 1rem;">
        <h3 class="hd-panel-title">D铆a {d}</h3>
        {#for sc in event.scenarios}
          {#if !event.getAgendaForDayAndScenario(d, sc.id).isEmpty()}
          <h4 style="margin: 0 0 0.5rem 0;">{sc.name}</h4>
          <ul class="hd-list">
            {#for t in event.getAgendaForDayAndScenario(d, sc.id)}
              <li class="hd-table-cell" style="list-style: none; padding: 0.4rem 0;">{#if t.break}{#else}ｏ{/if} {t.startTimeStr} - {t.endTimeStr} | {t.name} <span class="badge {app:talkStateClass(t, event)}">{app:talkState(t, event)}</span></li>
            {/for}
          </ul>
          {/if}
        {/for}
      </div>
      {/for}
    </div>
    {/if}

    <!-- TODO: ajustar colores/espaciados exactos seg煤n maqueta Canva -->
  </div>
</section>
<script>
  (function(){
    const speakerSelect = document.getElementById('speakerSelect');
    const talkSelect = document.getElementById('talkSelect');
    if (speakerSelect && talkSelect) {
      function filterTalks(){
        const sid = speakerSelect.value;
        Array.from(talkSelect.options).forEach(opt => {
          if(!opt.value) return;
          opt.hidden = sid && opt.dataset.speaker !== sid;
        });
        talkSelect.value = '';
      }
      speakerSelect.addEventListener('change', filterTalks);
      filterTalks();
    }
  })();
</script>
{/body}
{/include}
