{#include layout/main activePage="eventos"}
{#title}
{#if event}
{event.title} - Homedir
{#else}
{i18n.events_detail_not_found_page_title}
{/if}
{/title}

{#body}
{#if event}
<header class="page-header">
  <div class="section-header">
    <p class="section-subtitle">
        <a href="/eventos" class="hd-link">← {i18n.events_detail_back_to_events}</a>
        {#if event.isOngoing()} · <span class="badge info">{i18n.events_detail_badge_ongoing}</span>{/if}
    </p>
    <h1 class="public-title">{event.title}</h1>
  </div>
  
  {#if event.formattedDate}
  <p class="section-subtitle">
    <span class="material-symbols-outlined" style="vertical-align: text-bottom; font-size: 1.2em;">calendar_month</span>
    {event.formattedDate} | {event.startTimeStr} – {event.endTimeStr} {i18n.events_detail_hours_suffix}{#if event.timezone} ({event.timezone}){/if}
  </p>
  {/if}
  
  {#if app:validUrl(event.mapUrl)}
  <p class="section-subtitle">
      <span class="material-symbols-outlined" style="vertical-align: text-bottom; font-size: 1.2em;">location_on</span>
      <a href="{event.mapUrl}" target="_blank" rel="noopener" class="hd-link">{i18n.events_detail_view_map}</a>
  </p>
  {/if}
</header>

<div class="page-grid">
    <!-- Main Info Column -->
    <div style="grid-column: 1 / -1;">
        <div class="section-card">
            <div style="display: flex; gap: 2rem; flex-wrap: wrap; align-items: start;">
                {#if app:validUrl(event.logoUrl)}
                <div style="flex: 0 0 150px;">
                    <img src="{event.logoUrl}" alt="{i18n.events_detail_logo_alt(event.title)}" style="width: 100%; border-radius: 8px; border: 2px solid rgba(255,255,255,0.2);">
                </div>
                {/if}
                
                <div style="flex: 1; min-width: 300px;">
                    <div class="event-tags" style="margin-bottom: 1rem;">
                        <span class="badge event-type {event.typeCss}">{event.typeLabel}</span>
                        {#if event.days > 1}
                        <span class="badge">{i18n.events_detail_duration_days(event.days)}</span>
                        {#else}
                        <span class="badge">{i18n.events_detail_duration_day(event.days)}</span>
                        {/if}
                    </div>
                
                    {#if event.description}
                    <p class="event-description" style="font-size: 1.1rem; margin-bottom: 1.5rem;">{event.description}</p>
                    {/if}

                    <div class="event-links" style="display: flex; gap: 0.5rem; flex-wrap: wrap; margin-bottom: 0.5rem;">
                        <a href="/event/{event.id}/cfp" class="btn login-btn-nav">
                            <span class="material-symbols-outlined">rate_review</span> {i18n.events_cfp_open_cta}
                        </a>
                    </div>
                    
                    {#if app:validUrl(event.website) || app:validUrl(event.twitter) || app:validUrl(event.linkedin) || app:validUrl(event.instagram) || app:validEmail(event.contactEmail) || app:validUrl(event.ticketsUrl)}
                    <div class="event-links" style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                        {#if app:validUrl(event.ticketsUrl)}
                        <a href="{event.ticketsUrl}" target="_blank" rel="noopener" class="btn-primary">
                            <span class="material-symbols-outlined">confirmation_number</span> {i18n.events_detail_tickets}
                        </a>
                        {/if}
                        
                        {#if app:validUrl(event.website)}
                        <a href="{event.website}" target="_blank" rel="noopener" class="btn login-btn-nav">
                            <span class="material-symbols-outlined">language</span> {i18n.events_detail_web}
                        </a>
                        {/if}
                        
                        {#if app:validUrl(event.twitter)}
                        <a href="{event.twitter}" target="_blank" rel="noopener" class="btn login-btn-nav">Twitter</a>
                        {/if}
                        
                        {#if app:validUrl(event.linkedin)}
                        <a href="{event.linkedin}" target="_blank" rel="noopener" class="btn login-btn-nav">LinkedIn</a>
                        {/if}
                        
                        {#if app:validUrl(event.instagram)}
                        <a href="{event.instagram}" target="_blank" rel="noopener" class="btn login-btn-nav">Instagram</a>
                        {/if}
                    </div>
                    {/if}
                </div>
            </div>
        </div>
    </div>

    <!-- Scenarios Section -->
    {#if !event.scenarios.isEmpty()}
    <div style="grid-column: 1 / -1; margin-top: 2rem;">
        <div class="section-header">
            <h2>{i18n.events_detail_scenarios_title}</h2>
        </div>
        <div class="main-sections" style="padding: 0; margin-top: 1rem; justify-content: start;">
            {#for s in event.scenarios}
            <article class="section-card" style="min-width: 250px;">
                <div class="icon-wrapper" style="width: 50px; height: 50px; margin-bottom: 1rem;">
                    <span class="material-symbols-outlined" style="font-size: 30px;">podium</span>
                </div>
                <h3>{s.name}</h3>
                {#if s.location}<p style="opacity: 0.8; font-size: 0.9rem; margin-bottom: 1rem;">{s.location}</p>{/if}
                <a href="/event/{event.id}/scenario/{s.id}" class="hd-link">{i18n.events_detail_view_talks} →</a>
            </article>
            {/for}
        </div>
    </div>
    {/if}

    <!-- Agenda Section -->
    {#if !event.agenda.isEmpty()}
    <div id="agenda" style="grid-column: 1 / -1; margin-top: 3rem;">
        <div class="section-header" style="flex-direction: row; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
            <h2>{i18n.events_detail_agenda_title}</h2>
            <div class="view-toggle">
                <button id="agendaSeqBtn" data-agenda-seq-btn class="btn login-btn-nav active" type="button">{i18n.events_detail_agenda_sequential}</button>
                <button id="agendaGridBtn" data-agenda-grid-btn class="btn login-btn-nav" type="button" style="opacity: 0.7;">{i18n.events_detail_agenda_by_scenario}</button>
            </div>
        </div>

        {#for d in event.dayList}
        <div class="section-card" style="margin-bottom: 2rem;">
            <h3 style="margin-bottom: 1.5rem; color: var(--color-accent); border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 0.5rem;">
                {i18n.events_detail_day_label(d)}
            </h3>
            
            <!-- Sequential View -->
            <div id="agenda-seq-{d}" class="agenda-view agenda-seq" data-agenda-seq>
                <table class="hd-table agenda-table">
                    <thead>
                        <tr>
                            <th>{i18n.events_detail_table_time}</th>
                            <th>{i18n.events_detail_table_activity}</th>
                            <th>{i18n.events_detail_table_speakers}</th>
                            <th>{i18n.events_detail_table_scenario}</th>
                        </tr>
                    </thead>
                    <tbody>
                        {#for t in event.getAgendaForDay(d)}
                        <tr class="hd-table-row">
                            <td class="agenda-time hd-table-cell">{t.startTimeStr} - {t.endTimeStr}</td>
                            <td class="agenda-title hd-table-cell">
                                <span class="icon">
                                    {#if t.break}
                                    <span class="material-symbols-outlined">coffee</span>
                                    {#else}
                                    <span class="material-symbols-outlined">record_voice_over</span>
                                    {/if}
                                </span>
                                {#if t.break}
                                <span>{t.name}</span>
                                {#else}
                                <a href="/talk/{t.id}">{t.name}</a>
                                {/if}
                            </td>
                            <td class="agenda-speakers hd-table-cell">
                                {#if !t.break && !t.speakers.isEmpty()}
                                <div class="speaker-avatars">
                                    {#for s in t.speakers}
                                    <a href="/speaker/{s.id}" title="{s.name}" style="text-decoration: none;">
                                        {#if app:validUrl(s.photoUrl)}
                                        <img src="{s.photoUrl}" alt="{s.name}" class="avatar">
                                        {#else}
                                        <span class="avatar placeholder"><span class="material-symbols-outlined" style="font-size: 16px;">person</span></span>
                                        {/if}
                                    </a>
                                    {/for}
                                </div>
                                {/if}
                            </td>
                            <td class="agenda-location hd-table-cell">
                                <a href="/event/{event.id}/scenario/{t.location}">{event.getScenarioName(t.location)}</a>
                            </td>
                        </tr>
                        {/for}
                    </tbody>
                </table>
            </div>

            <!-- Grid View -->
            <div id="agenda-grid-{d}" class="agenda-view agenda-grid hidden" data-agenda-grid>
                <div style="overflow-x: auto;">
                    <table class="hd-table agenda-grid-table">
                        <thead>
                            <tr>
                                <th>{i18n.events_detail_table_time}</th>
                                {#for sc in event.scenarios}
                                <th>{sc.name}</th>
                                {/for}
                            </tr>
                        </thead>
                        <tbody>
                            {#for e in event.getAgendaGroupedByTimeSlot(d).entrySet()}
                            <tr class="hd-table-row">
                                <td class="agenda-time hd-table-cell" style="text-align: center;">{e.key}</td>
                                {#for sc in event.scenarios}
                                <td class="hd-table-cell">
                                    {#for t in e.value}
                                    {#if t.location == sc.id}
                                    <div class="agenda-slot">
                                        {#if t.break}
                                        {t.name}
                                        {#else}
                                        <a href="/talk/{t.id}">{t.name}</a>
                                        {#if !t.speakers.isEmpty()}
                                        <div class="agenda-slot-speakers">
                                            {#for s in t.speakers}
                                            {s.name}{#if !s_isLast}, {/if}
                                            {/for}
                                        </div>
                                        {/if}
                                        {/if}
                                    </div>
                                    {/if}
                                    {/for}
                                </td>
                                {/for}
                            </tr>
                            {/for}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        {/for}
    </div>
    {/if}

</div>
{#else}
<div class="page-container" style="display: flex; justify-content: center; align-items: center; min-height: 50vh;">
    <div class="section-card" style="text-align: center;">
        <span class="material-symbols-outlined" style="font-size: 4rem; opacity: 0.5; margin-bottom: 1rem;">event_busy</span>
        <h2>{i18n.events_detail_not_found_title}</h2>
        <p>{i18n.events_detail_not_found_desc}</p>
        <a href="/eventos" class="btn-primary" style="margin-top: 1.5rem;">{i18n.events_detail_not_found_cta}</a>
    </div>
</div>
{/if}
{/body}
{/include}
