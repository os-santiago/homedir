{#include layout/base}
{#title}Capacidad{/title}
{#breadcrumbs}<a href="/private/profile">Perfil</a><span class="sep">/</span><a href="/private/admin">Admin</a><span class="sep">/</span><span>Capacidad</span>{/breadcrumbs}
{#main}
<section>
    <h1 class="page-title">Control de capacidad</h1>
    <ul class="card">
        <li>Modo actual: {status.mode.name() == 'ADMITTING' ? 'Admitiendo' : 'Conteniendo nuevos logins'}</li>
        <li>Usuarios activos en memoria: {status.activeUsers}</li>
        <li>% de memoria usada: {status.memoryPercent}%</li>
        <li>% de disco libre: {status.diskFreePercent}%</li>
        <li>Última evaluación: {status.lastEvaluation}</li>
        <li>Tendencia: {status.trendNameLower}</li>
    </ul>
    <h2 class="page-title">Lecturas</h2>
    <ul class="card">
        <li>Lecturas desde memoria: {reads.memory}</li>
        <li>Refrescos ejecutados: {reads.refreshCount}</li>
        <li>Lecturas coalescidas: {reads.refreshCoalesced}</li>
        <li>Duración último refresco (ms): {reads.refreshLastDurationMs}</li>
        <li>Duración p95 (ms): {reads.refreshP95Ms}</li>
        <li>Lecturas servidas en refresco: {reads.staleServed}</li>
    </ul>
    <h2 class="page-title">Escrituras</h2>
    <ul class="card">
        <li>Cola: {writes.depth}/{writes.max}</li>
        <li>Antigüedad más vieja (ms): {writes.oldestAgeMs}</li>
        <li>OK: {writes.writesOk} &middot; Fallos: {writes.writesFail} &middot; Reintentos: {writes.writesRetries}</li>
        <li>Descartados por capacidad: {writes.droppedDueCapacity}</li>
        {#if writes.lastError}
        <li>Último error: {writes.lastError}</li>
        {/if}
    </ul>
    <button class="btn btn-secondary" onclick="copyState()">Copiar estado</button>
    <script>
    function copyState() {
        const text = `Modo: {status.mode.name()}\nMemoria usada: {status.memoryPercent}%\nDisco libre: {status.diskFreePercent}%\nLecturas: {reads.memory}\nCola escrituras: {writes.depth}/{writes.max}`;
        navigator.clipboard.writeText(text);
    }
    </script>
    <a href="/private/admin" class="btn btn-secondary">Volver a admin</a>
</section>
{/main}
{/include}
