{#include layout/main}

{#title}Capacidad · Homedir{/title}

{#body}
<section class="hd-section hd-section-dashboard">
  <div class="hd-page hd-page-narrow">
    <div class="hd-dashboard-header">
      <div>
        <p class="hd-eyebrow">Administración</p>
        <h1 class="hd-page-title">Control de capacidad</h1>
        <p class="hd-page-intro">Monitorea el estado de memoria y disco para proteger el login.</p>
      </div>
      <div class="hd-panel-actions">
        <a href="/private/admin" class="hd-btn hd-btn-secondary">Volver a admin</a>
      </div>
    </div>

    <div class="hd-panel">
      <h2 class="hd-panel-title">Estado actual</h2>
      <table class="hd-table">
        <tbody>
          <tr class="hd-table-row">
            <th class="hd-table-head">Modo actual</th>
            <td class="hd-table-cell">{#if status.mode == 'ADMITTING'}Admitiendo{#else}Conteniendo nuevos logins{/if}
            </td>
          </tr>
          <tr class="hd-table-row">
            <th class="hd-table-head">Usuarios activos</th>
            <td class="hd-table-cell">{status.activeUsers}</td>
          </tr>
          <tr class="hd-table-row">
            <th class="hd-table-head">Memoria usada</th>
            <td class="hd-table-cell">{status.memoryPercent}%</td>
          </tr>
          <tr class="hd-table-row">
            <th class="hd-table-head">Disco libre</th>
            <td class="hd-table-cell">{status.diskFreePercent}%</td>
          </tr>
          <tr class="hd-table-row">
            <th class="hd-table-head">Última evaluación</th>
            <td class="hd-table-cell">{status.lastEvaluation}</td>
          </tr>
          <tr class="hd-table-row">
            <th class="hd-table-head">Tendencia</th>
            <td class="hd-table-cell">{status.trendNameLower}</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="hd-panel">
      <h2 class="hd-panel-title">Lecturas</h2>
      <table class="hd-table">
        <tbody>
          <tr class="hd-table-row">
            <th class="hd-table-head">Lecturas desde memoria</th>
            <td class="hd-table-cell">{reads.memory}</td>
          </tr>
          <tr class="hd-table-row">
            <th class="hd-table-head">Refrescos ejecutados</th>
            <td class="hd-table-cell">{reads.refreshCount}</td>
          </tr>
          <tr class="hd-table-row">
            <th class="hd-table-head">Lecturas coalescidas</th>
            <td class="hd-table-cell">{reads.refreshCoalesced}</td>
          </tr>
          <tr class="hd-table-row">
            <th class="hd-table-head">Duración último refresco</th>
            <td class="hd-table-cell">{reads.refreshLastDurationMs} ms</td>
          </tr>
          <tr class="hd-table-row">
            <th class="hd-table-head">Duración p95</th>
            <td class="hd-table-cell">{reads.refreshP95Ms} ms</td>
          </tr>
          <tr class="hd-table-row">
            <th class="hd-table-head">Lecturas servidas en refresco</th>
            <td class="hd-table-cell">{reads.staleServed}</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="hd-panel">
      <h2 class="hd-panel-title">Escrituras</h2>
      <table class="hd-table">
        <tbody>
          <tr class="hd-table-row">
            <th class="hd-table-head">Cola</th>
            <td class="hd-table-cell">{writes.depth}/{writes.max}</td>
          </tr>
          <tr class="hd-table-row">
            <th class="hd-table-head">Antigüedad más vieja</th>
            <td class="hd-table-cell">{writes.oldestAgeMs} ms</td>
          </tr>
          <tr class="hd-table-row">
            <th class="hd-table-head">Resultados</th>
            <td class="hd-table-cell">OK: {writes.writesOk} · Fallos: {writes.writesFail} · Reintentos:
              {writes.writesRetries}</td>
          </tr>
          <tr class="hd-table-row">
            <th class="hd-table-head">Descartados por capacidad</th>
            <td class="hd-table-cell">{writes.droppedDueCapacity}</td>
          </tr>
          {#if writes.lastError}
          <tr class="hd-table-row">
            <th class="hd-table-head">Último error</th>
            <td class="hd-table-cell">{writes.lastError}</td>
          </tr>
          {/if}
        </tbody>
      </table>
      <div class="hd-form-actions hd-form-actions-margin">
        <button class="hd-btn hd-btn-secondary" type="button" onclick="copyState()">Copiar estado</button>
      </div>
    </div>

    <script>
      function copyState() {
        const text = `Modo: {status.mode}\nMemoria usada: {status.memoryPercent}%\nDisco libre: {status.diskFreePercent}%\nLecturas: {reads.memory}\nCola escrituras: {writes.depth}/{writes.max}`;
        navigator.clipboard.writeText(text);
      }
    </script>
    <!-- TODO: ajustar colores/espaciados exactos según maqueta Canva -->
  </div>
</section>
{/body}
{/include}