{#include layout/main activePage="comunidad"}
{#title}{meta.title} · Community Board{/title}
{#body}
  <header class="page-header events-page-header">
    <div class="section-header">
      <p class="section-subtitle">Community · Board</p>
      <h1>{meta.title}</h1>
    </div>
    <p class="section-subtitle">{meta.description}</p>
    <p class="section-subtitle"><strong>{page.totalMembers}</strong> members</p>
    {#if page.integrationPending}
      <p class="section-subtitle">Discord integration is pending and will be enabled in the next iteration.</p>
    {/if}
    <div class="community-board-actions">
      <a class="btn-primary" href="/community/board">Back to Community Board</a>
      <a class="btn-primary" href="/community/feed">Community Feed</a>
      <a class="btn-primary" href="/community/picks">Community Picks</a>
    </div>
  </header>

  <section class="page-grid">
    <article class="section-card events-full-width">
      <form method="get" class="community-search-form">
        <input
          type="search"
          name="q"
          value="{page.query}"
          placeholder="Search by name, handle or email"
          class="community-search-input">
        <button class="btn-primary" type="submit">Search</button>
      </form>
      <small class="community-board-small">{page.filteredMembers} results</small>
    </article>
  </section>

  <section class="page-grid">
    {#if page.members.isEmpty()}
      <article class="section-card events-full-width">
        <p>No members found for this filter.</p>
      </article>
    {#else}
      {#for member in page.members}
        <article class="section-card member-row-card" id="member-{member.ref}">
          <div class="member-row-head">
            {#if member.avatarUrl}
              <img src="{member.avatarUrl}" alt="{member.displayName}" class="member-row-avatar">
            {#else}
              <div class="member-row-avatar member-row-avatar-fallback">{member.displayName.substring(0,1).toUpperCase}</div>
            {/if}
            <div>
              <h3 class="member-row-name">{member.displayName}</h3>
              <p class="member-row-id">{member.identifier}</p>
              <small class="member-row-date">Member since: {member.joinedAtText}</small>
            </div>
          </div>
          <div class="member-row-actions">
            <a class="btn-primary" href="{member.sharePath}">Open profile</a>
            <button type="button" class="btn-primary copy-member-link" data-path="{member.sharePath}">Copy profile link</button>
            {#if member.publicProfilePath}
              <a class="btn-primary" href="{member.publicProfilePath}" target="_blank" rel="noopener noreferrer">Open public profile</a>
            {/if}
          </div>
        </article>
      {/for}
    {/if}
  </section>

  <style>
    .community-board-actions {
      display: flex;
      gap: 0.75rem;
      flex-wrap: wrap;
      margin-top: 0.75rem;
    }

    .community-search-form {
      display: flex;
      gap: 0.75rem;
      flex-wrap: wrap;
    }

    .community-search-input {
      min-width: 260px;
      flex: 1 1 280px;
      border: 1px solid rgba(255, 255, 255, 0.35);
      background: rgba(0, 0, 0, 0.25);
      color: #fff;
      border-radius: 8px;
      padding: 0.55rem 0.7rem;
    }

    .community-board-small {
      display: block;
      margin-top: 0.7rem;
      opacity: 0.75;
    }

    .member-row-card {
      display: flex;
      justify-content: space-between;
      gap: 1rem;
      align-items: center;
      flex-wrap: wrap;
    }

    .member-row-head {
      display: flex;
      gap: 0.8rem;
      align-items: center;
    }

    .member-row-avatar {
      width: 52px;
      height: 52px;
      border-radius: 999px;
      object-fit: cover;
      border: 2px solid rgba(255, 255, 255, 0.5);
    }

    .member-row-avatar-fallback {
      display: inline-flex;
      justify-content: center;
      align-items: center;
      font-weight: 700;
      background: rgba(255, 255, 255, 0.1);
    }

    .member-row-name {
      margin: 0 0 0.15rem;
      font-size: 1rem;
    }

    .member-row-id {
      margin: 0 0 0.2rem;
      opacity: 0.82;
    }

    .member-row-date {
      opacity: 0.7;
    }

    .member-row-actions {
      display: flex;
      gap: 0.6rem;
      flex-wrap: wrap;
    }
  </style>

  <script>
    (function () {
      function copyPath(path) {
        var text = window.location.origin + path;
        if (navigator.clipboard && navigator.clipboard.writeText) {
          return navigator.clipboard.writeText(text);
        }
        var input = document.createElement("input");
        input.value = text;
        document.body.appendChild(input);
        input.select();
        document.execCommand("copy");
        input.remove();
        return Promise.resolve();
      }

      document.querySelectorAll(".copy-member-link").forEach(function (button) {
        button.addEventListener("click", function () {
          var path = button.getAttribute("data-path");
          if (!path) return;
          copyPath(path).then(function () {
            var previous = button.textContent;
            button.textContent = "Copied";
            setTimeout(function () {
              button.textContent = previous;
            }, 1200);
          });
        });
      });
    })();
  </script>
{/body}
{/include}

