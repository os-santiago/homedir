{#include layout/main activePage="comunidad"}
{#title}
{#if groupPath == 'homedir-users'}
{i18n.community_board_group_homedir} 路 {i18n.community_board_heading}
{#else if groupPath == 'github-users'}
{i18n.community_board_group_github} 路 {i18n.community_board_heading}
{#else if groupPath == 'discord-users'}
{i18n.community_board_group_discord} 路 {i18n.community_board_heading}
{#else}
{groupTitle} 路 {i18n.community_board_heading}
{/if}
{/title}
{#body}
  <header class="page-header events-page-header">
    <div class="section-header">
      <p class="section-subtitle">{i18n.community_board_subtitle}</p>
      <h1>
        {#if groupPath == 'homedir-users'}
        {i18n.community_board_group_homedir}
        {#else if groupPath == 'github-users'}
        {i18n.community_board_group_github}
        {#else if groupPath == 'discord-users'}
        {i18n.community_board_group_discord}
        {#else}
        {groupTitle}
        {/if}
      </h1>
    </div>
    <p class="section-subtitle">
      {#if groupPath == 'homedir-users'}
      {i18n.community_board_group_homedir_desc}
      {#else if groupPath == 'github-users'}
      {i18n.community_board_group_github_desc}
      {#else if groupPath == 'discord-users'}
      {i18n.community_board_group_discord_desc}
      {#else}
      {groupDescription}
      {/if}
    </p>
  </header>
  {#include fragments/community-submenu.html /}

  <section class="page-grid">
    <div class="section-card events-full-width board-detail-shell">
      <div class="board-detail-head">
        <p class="section-subtitle">{i18n.community_board_members_count(total)}</p>
        {#if total > 0}
          <p class="section-subtitle">{i18n.community_board_pagination_status(pageStart, pageEnd, total)}</p>
        {/if}
      </div>

      <form class="search-form board-search-form" method="get" action="/comunidad/board/{groupPath}">
        <input
          type="search"
          name="q"
          value="{searchQuery}"
          placeholder="{i18n.community_board_search_placeholder}"
          aria-label="{i18n.community_board_search_aria}"
          class="board-search-input" />
        <input type="hidden" name="limit" value="{limit}" />
        <button type="submit" class="btn-primary">{i18n.community_board_search}</button>
      </form>

      <div class="board-members-grid">
        {#if members.isEmpty}
          <article class="board-member-card">
            <p>{i18n.community_board_no_members}</p>
          </article>
        {#else}
          {#for member in members}
            <article class="board-member-card {#if highlightedMember == member.id}is-highlighted{/if}">
              <div class="board-member-main">
                {#if member.avatarUrl}
                  <img class="board-member-avatar" src="{member.avatarUrl}" alt="{member.displayName}" loading="lazy" decoding="async" fetchpriority="low" width="44" height="44" />
                {#else}
                  <div class="board-member-avatar board-member-avatar-fallback">
                    {member.displayName.substring(0,1)}
                  </div>
                {/if}
                <div class="board-member-text">
                  <h2>{member.displayName}</h2>
                  <p>{member.handle}</p>
                  {#if member.memberSince}
                    <small>{i18n.community_board_member_since(member.memberSince)}</small>
                  {/if}
                </div>
              </div>
              <div class="board-member-actions">
                <a class="btn-primary" href="{member.profileLink}">{i18n.community_board_open}</a>
                <button
                  type="button"
                  class="btn-primary board-copy-btn"
                  data-default-label="{i18n.community_board_copy_profile_link}"
                  data-success-label="{i18n.community_board_link_copied}"
                  data-error-label="{i18n.community_board_copy_failed}"
                  data-share-link="{member.shareLink}">
                  {i18n.community_board_copy_profile_link}
                </button>
              </div>
            </article>
          {/for}
        {/if}
      </div>

      <div class="board-pagination">
        {#if hasPreviousPage}
          <a class="btn-primary" href="{previousPageUrl}">{i18n.community_board_prev}</a>
        {#else}
          <span class="btn-primary board-page-disabled">{i18n.community_board_prev}</span>
        {/if}
        {#if hasNextPage}
          <a class="btn-primary" href="{nextPageUrl}">{i18n.community_board_next}</a>
        {#else}
          <span class="btn-primary board-page-disabled">{i18n.community_board_next}</span>
        {/if}
      </div>
    </div>
  </section>

  <style>
    body.ultra-lite-mode .board-detail-shell,
    body.ultra-lite-mode .board-detail-shell *,
    body.ultra-lite-mode .board-detail-shell *::before,
    body.ultra-lite-mode .board-detail-shell *::after {
      animation: none !important;
      transition: none !important;
      transform: none !important;
      will-change: auto !important;
    }

    body.ultra-lite-mode .board-detail-shell,
    body.ultra-lite-mode .board-members-grid,
    body.ultra-lite-mode .board-member-card,
    body.ultra-lite-mode .board-member-main,
    body.ultra-lite-mode .board-member-text,
    body.ultra-lite-mode .board-member-actions {
      opacity: 1 !important;
      visibility: visible !important;
    }
    .floating-shapes {
      display: none;
    }

    .board-detail-shell,
    .board-detail-shell:hover {
      transform: none;
      animation: none;
      cursor: default;
      will-change: auto;
    }

    .board-detail-shell::before,
    .board-detail-shell:hover::before {
      content: none;
    }

    .board-detail-shell .btn-primary,
    .board-detail-shell .btn-primary:hover,
    .board-detail-shell .btn-primary:active,
    .board-detail-shell .board-member-card,
    .board-detail-shell .board-member-card:hover {
      transform: none !important;
      animation: none !important;
      transition: none !important;
      will-change: auto !important;
    }

    .board-detail-head {
      display: flex;
      justify-content: flex-start;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1rem;
      flex-wrap: wrap;
    }

    .board-search-form {
      display: flex;
      gap: 0.75rem;
      margin-bottom: 1rem;
      flex-wrap: wrap;
    }

    .board-search-input {
      flex: 1 1 280px;
      min-width: 220px;
      background: rgba(0, 0, 0, 0.55);
      border: 2px solid rgba(255, 255, 255, 0.5);
      border-radius: 8px;
      color: #fff;
      padding: 0.6rem 0.75rem;
    }

    .board-members-grid {
      display: grid;
      gap: 0.85rem;
    }

    .board-member-card {
      border: 2px solid rgba(255, 255, 255, 0.35);
      border-radius: 10px;
      padding: 0.85rem;
      background: rgba(0, 0, 0, 0.35);
      box-shadow: none;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.9rem;
      flex-wrap: wrap;
      transition: none;
      animation: none;
      transform: none;
    }

    .board-member-card.is-highlighted {
      border-color: rgba(120, 255, 160, 0.9);
      box-shadow: 0 0 0 2px rgba(120, 255, 160, 0.18) inset;
    }

    .board-member-main {
      display: flex;
      align-items: center;
      gap: 0.8rem;
      min-width: 260px;
    }

    .board-member-avatar {
      width: 44px;
      height: 44px;
      border-radius: 999px;
      object-fit: cover;
      border: 2px solid rgba(255, 255, 255, 0.6);
      background: rgba(0, 0, 0, 0.5);
      flex-shrink: 0;
    }

    .board-member-avatar-fallback {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
    }

    .board-member-text h2 {
      margin: 0;
      font-size: 1rem;
    }

    .board-member-text p {
      margin: 0.2rem 0;
      opacity: 0.9;
    }

    .board-member-actions {
      display: flex;
      gap: 0.6rem;
      align-items: center;
      flex-wrap: wrap;
    }

    .board-pagination {
      margin-top: 1rem;
      display: flex;
      gap: 0.6rem;
      justify-content: center;
      flex-wrap: wrap;
    }

    .board-page-disabled {
      opacity: 0.5;
      pointer-events: none;
      user-select: none;
    }

    .board-copy-btn.is-done {
      border-color: rgba(120, 255, 160, 0.9);
      background: rgba(120, 255, 160, 0.15);
    }
  </style>

  <script>
    document.addEventListener("click", async function (event) {
      const target = event.target;
      if (!(target instanceof HTMLElement)) {
        return;
      }
      const button = target.closest(".board-copy-btn");
      if (!button) {
        return;
      }
      const rawLink = button.getAttribute("data-share-link");
      if (!rawLink) {
        return;
      }
      const fullLink = new URL(rawLink, window.location.origin).toString();
      try {
        await navigator.clipboard.writeText(fullLink);
        button.classList.add("is-done");
        button.textContent = button.getAttribute("data-success-label") || "OK";
        setTimeout(function () {
          button.classList.remove("is-done");
          button.textContent = button.getAttribute("data-default-label") || "Copy";
        }, 1200);
      } catch (err) {
        button.textContent = button.getAttribute("data-error-label") || "Error";
        setTimeout(function () {
          button.textContent = button.getAttribute("data-default-label") || "Copy";
        }, 1200);
      }
    });
  </script>
{/body}
{/include}
