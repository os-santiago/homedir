{#include layout/main activePage="comunidad"}
{#title}{groupTitle} · Community Board{/title}
{#body}
  <header class="page-header events-page-header">
    <div class="section-header">
      <p class="section-subtitle">Community · Board</p>
      <h1>{groupTitle}</h1>
    </div>
    <p class="section-subtitle">{groupDescription}</p>
  </header>
  {#include fragments/community-submenu.html /}

  <section class="page-grid">
    <div class="section-card events-full-width board-detail-shell">
      <div class="board-detail-head">
        <p class="section-subtitle">{total} members</p>
      </div>

      <form class="search-form board-search-form" method="get" action="/comunidad/board/{groupPath}">
        <input
          type="search"
          name="q"
          value="{searchQuery}"
          placeholder="Search by name, handle or email"
          aria-label="Search member"
          class="board-search-input" />
        <input type="hidden" name="limit" value="{limit}" />
        <button type="submit" class="btn-primary">Search</button>
      </form>

      <div class="board-members-grid">
        {#if members.isEmpty}
          <article class="board-member-card">
            <p>No members found with current filter.</p>
          </article>
        {#else}
          {#for member in members}
            <article class="board-member-card {#if highlightedMember == member.id}is-highlighted{/if}">
              <div class="board-member-main">
                {#if member.avatarUrl}
                  <img class="board-member-avatar" src="{member.avatarUrl}" alt="{member.displayName}" loading="lazy" />
                {#else}
                  <div class="board-member-avatar board-member-avatar-fallback">
                    {member.displayName.substring(0,1)}
                  </div>
                {/if}
                <div class="board-member-text">
                  <h2>{member.displayName}</h2>
                  <p>{member.handle}</p>
                  {#if member.memberSince}
                    <small>Member since {member.memberSince}</small>
                  {/if}
                </div>
              </div>
              <div class="board-member-actions">
                <a class="btn-primary" href="{member.profileLink}">Open</a>
                <button
                  type="button"
                  class="btn-primary board-copy-btn"
                  data-share-link="{member.shareLink}">
                  Copy profile link
                </button>
              </div>
            </article>
          {/for}
        {/if}
      </div>
    </div>
  </section>

  <style>
    .board-detail-shell,
    .board-detail-shell:hover {
      transform: none;
      animation: none;
      cursor: default;
    }

    .board-detail-head {
      display: flex;
      justify-content: flex-start;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1rem;
      flex-wrap: wrap;
    }

    .board-search-form {
      display: flex;
      gap: 0.75rem;
      margin-bottom: 1rem;
      flex-wrap: wrap;
    }

    .board-search-input {
      flex: 1 1 280px;
      min-width: 220px;
      background: rgba(0, 0, 0, 0.55);
      border: 2px solid rgba(255, 255, 255, 0.5);
      border-radius: 8px;
      color: #fff;
      padding: 0.6rem 0.75rem;
    }

    .board-members-grid {
      display: grid;
      gap: 0.85rem;
    }

    .board-member-card {
      border: 2px solid rgba(255, 255, 255, 0.35);
      border-radius: 10px;
      padding: 0.85rem;
      background: rgba(0, 0, 0, 0.35);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.9rem;
      flex-wrap: wrap;
    }

    .board-member-card.is-highlighted {
      border-color: rgba(120, 255, 160, 0.9);
      box-shadow: 0 0 0 2px rgba(120, 255, 160, 0.18) inset;
    }

    .board-member-main {
      display: flex;
      align-items: center;
      gap: 0.8rem;
      min-width: 260px;
    }

    .board-member-avatar {
      width: 44px;
      height: 44px;
      border-radius: 999px;
      object-fit: cover;
      border: 2px solid rgba(255, 255, 255, 0.6);
      background: rgba(0, 0, 0, 0.5);
      flex-shrink: 0;
    }

    .board-member-avatar-fallback {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
    }

    .board-member-text h2 {
      margin: 0;
      font-size: 1rem;
    }

    .board-member-text p {
      margin: 0.2rem 0;
      opacity: 0.9;
    }

    .board-member-actions {
      display: flex;
      gap: 0.6rem;
      align-items: center;
      flex-wrap: wrap;
    }

    .board-copy-btn.is-done {
      border-color: rgba(120, 255, 160, 0.9);
      background: rgba(120, 255, 160, 0.15);
    }
  </style>

  <script>
    document.addEventListener("click", async function (event) {
      const target = event.target;
      if (!(target instanceof HTMLElement)) {
        return;
      }
      const button = target.closest(".board-copy-btn");
      if (!button) {
        return;
      }
      const rawLink = button.getAttribute("data-share-link");
      if (!rawLink) {
        return;
      }
      const fullLink = new URL(rawLink, window.location.origin).toString();
      try {
        await navigator.clipboard.writeText(fullLink);
        button.classList.add("is-done");
        button.textContent = "Link copied";
        setTimeout(function () {
          button.classList.remove("is-done");
          button.textContent = "Copy profile link";
        }, 1200);
      } catch (err) {
        button.textContent = "Copy failed";
        setTimeout(function () {
          button.textContent = "Copy profile link";
        }, 1200);
      }
    });
  </script>
{/body}
{/include}
